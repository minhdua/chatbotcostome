"""add attribute for product

Revision ID: 77ceca2c8d8b
Revises: 77ceca2c8d8a
Create Date: 2023-09-11 00:38:39.908158

"""
import os

import sqlalchemy as sa
from alembic import op
from models.attribute_prediction import AttributePrediction
from models.category_prediction import CategoryPrediction
from sqlalchemy.orm import sessionmaker

# revision identifiers, used by Alembic.
revision = '77ceca2c8d8c'
down_revision = '77ceca2c8d8b'
branch_labels = None
depends_on = None


def upgrade():
     # Tạo bảng AttributePrediction nếu nó không tồn tại
    if not op.get_context().dialect.has_table(op.get_context().bind, 'attribute_prediction'):
        op.create_table(
            'attribute_prediction',
            sa.Column('id', sa.Integer(), nullable=False),
            sa.Column('name', sa.String(length=255), nullable=True),
            # Các cột khác của bảng AttributePrediction
            sa.PrimaryKeyConstraint('id'),
        )

    # Tạo bảng CategoryPrediction nếu nó không tồn tại
    if not op.get_context().dialect.has_table(op.get_context().bind, 'category_prediction'):
        op.create_table(
            'category_prediction',
            sa.Column('id', sa.Integer(), nullable=False),
            sa.Column('name', sa.String(length=255), nullable=True),
            # Các cột khác của bảng CategoryPrediction
            sa.PrimaryKeyConstraint('id'),
        )

   # Đường dẫn đến tệp list_attr_cloth.txt
    attr_file_path = 'F:\\chatbotsupportcostume-main\\backend\\resources\\cnn\\list_attr_cloth.txt'

    if os.path.exists(attr_file_path):
        with open(attr_file_path, 'r') as file:
            lines = file.readlines()
            for line in lines[2:]:
                attribute_name = line.strip()
                # Thêm thuộc tính vào cơ sở dữ liệu
                attribute = AttributePrediction(name=attribute_name)  # Điều chỉnh 'attribute_type' nếu cần
                session = sessionmaker(bind=op.get_bind())()
                session.add(attribute)
                session.commit()

    # Đường dẫn đến tệp list_category_cloth.txt
    category_file_path = 'F:\\chatbotsupportcostume-main\\backend\\resources\\cnn\\list_category_cloth.txt'

    if os.path.exists(category_file_path):
        with open(category_file_path, 'r') as file:
            lines = file.readlines()
            for line in lines[1:]:
                category_name = line.strip()
                # Thêm danh mục vào cơ sở dữ liệu
                category = CategoryPrediction(name=category_name)  # Thay thế 'Category' bằng tên lớp mô hình của bạn
                session = sessionmaker(bind=op.get_bind())()
                session.add(category)
                session.commit()

def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('attribute', 'attribute_name')

    # ### end Alembic commands ###